/*
* Copyright (C) 2013 CoDyCo
* Author: Andrea Del Prete
* email: andrea.delprete@iit.it
* Permission is granted to copy, distribute, and/or modify this program
* under the terms of the GNU General Public License, version 2 or any
* later version published by the Free Software Foundation.
*
* A copy of the license can be found at
* http://www.robotcub.org/icub/license/gpl.txt
*
* This program is distributed in the hope that it will be useful, but
* WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General
* Public License for more details
*/

#include "thread.h"
#include <wbiIcub/wholeBodyInterfaceIcub.h>
#include <yarp/os/Time.h>
#include <yarp/os/Log.h>


using namespace basicWholeBodyInterfaceNamespace;
using namespace yarp::math;
using namespace wbiIcub;


//*************************************************************************************************************************
LocomotionThread::LocomotionThread(string _name, string _robotName, int _period, wholeBodyInterface *_wbi)
    : RateThread(_period), name(_name), robotName(_robotName), robot(_wbi)
{
    printCountdown = 0;
}

//*************************************************************************************************************************
bool LocomotionThread::threadInit()
{
	qRad.resize(robot->getDoFs());
    return true;
}

//*************************************************************************************************************************
void LocomotionThread::run()
{
    bool res = robot->getEstimates(ESTIMATE_JOINT_POS, qRad.data(), -1.0);
    std::cout << "The robot encoders values are: " << std::endl;
    std::cout << qRad.toString() << std::endl;
    printCountdown = (printCountdown>=PRINT_PERIOD) ? 0 : printCountdown +(int)getRate(); // countdown for next print (see sendMsg method)
}
